(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     15662,        393]
NotebookOptionsPosition[     14774,        363]
NotebookOutlinePosition[     15122,        378]
CellTagsIndexPosition[     15079,        375]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"Quit", "[", "]"}], "   ", 
  RowBox[{"(*", 
   RowBox[{
   "similar", " ", "to", " ", "clear", " ", "all", " ", "in", " ", "Matlab"}],
    "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "If", " ", "something", " ", "takes", " ", "too", " ", "long", " ", "to", 
     " ", "run"}], ",", " ", 
    RowBox[{
    "it", " ", "can", " ", "be", " ", "aborted", " ", "by", " ", "pressing", 
     " ", "the", " ", "\"\<Abort Evaluation\>\"", " ", "function", " ", 
     "under", " ", "the", " ", "\"\<Evaluation\>\"", " ", 
     RowBox[{"tab", "."}]}]}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.7484616903933487`*^9, 3.748461697553911*^9}, {
  3.748628135670982*^9, 3.748628212741001*^9}}],

Cell["\<\
Expression for exponentially distributed trip times and wages\
\>", "Item",
 CellChangeTimes->{{3.74846098833583*^9, 3.748460990491558*^9}, {
  3.748461069853651*^9, 3.7484610700850863`*^9}, {3.748461147362315*^9, 
  3.748461176288618*^9}, {3.748627956275278*^9, 3.7486279715260878`*^9}}],

Cell[BoxData[
 RowBox[{"$Assumptions", "=", 
  RowBox[{
   RowBox[{"p", ">", "0"}], "&&", 
   RowBox[{"p", "\[Element]", " ", "Reals"}], "&&", 
   RowBox[{"B", "\[Element]", "Reals"}], "&&", 
   RowBox[{"B", ">=", "0"}]}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"k", "=", 
     RowBox[{
     "itensity", " ", "of", " ", "the", " ", "resrvation", " ", "prices"}]}], 
    ";", " ", 
    RowBox[{"v", " ", "=", " ", 
     RowBox[{"itensity", " ", "of", " ", "the", " ", "trip", " ", "times"}]}],
     ";", " ", 
    RowBox[{"pm", "=", 
     RowBox[{"<", "p", ">"}]}], ";", " ", 
    RowBox[{"l", "=", 
     RowBox[{
      RowBox[{"\\", "lambda_"}], "0"}]}], ";", " ", 
    RowBox[{"pr", "=", 
     RowBox[{"p_", 
      RowBox[{"{", "ret", "}"}]}]}], ";", " ", 
    RowBox[{"b", "=", 
     RowBox[{
      RowBox[{"\\", "tilde"}], 
      RowBox[{"{", "b", "}"}]}]}], ";", " ", 
    RowBox[{"bm", "=", 
     RowBox[{"b", "^", 
      RowBox[{"{", "-", "}"}]}]}], ";", " ", 
    RowBox[{"d", "=", 
     RowBox[{"\\", "Delta"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"exprrExp", "=", 
   RowBox[{"FullSimplify", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"l", "^", "2"}], "*", "b", "*", 
      RowBox[{"(", 
       RowBox[{"p", "-", 
        RowBox[{"pr", "*", "bm"}]}], ")"}], "*", 
      RowBox[{"Exp", "[", 
       RowBox[{
        RowBox[{"-", "2"}], "*", "k", "*", "p"}], "]"}], "*", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Integrate", "[", 
         RowBox[{
          RowBox[{"t", "*", "v", "*", 
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{"-", "v"}], "*", "t"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"t", ",", "0", ",", 
            RowBox[{"B", "/", "bm"}]}], "}"}]}], "]"}], ")"}], "^", "2"}]}], 
     "+", 
     RowBox[{
      RowBox[{"pm", "/", "d"}], "*", 
      RowBox[{"(", 
       RowBox[{"Btot", "-", "B"}], ")"}], "*", 
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"l", "*", "b", "*", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "k"}], "*", "p"}], "]"}], "*", 
         RowBox[{"Integrate", "[", 
          RowBox[{
           RowBox[{"t", "*", "v", "*", 
            RowBox[{"Exp", "[", 
             RowBox[{
              RowBox[{"-", "v"}], "*", "t"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "0", ",", 
             RowBox[{"B", "/", "bm"}]}], "}"}]}], "]"}]}]}], ")"}]}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{
  3.748460419747227*^9, 3.748460987226514*^9, {3.7484620829917383`*^9, 
   3.7484621522110147`*^9}, {3.748462225852567*^9, 3.7484622643196726`*^9}, {
   3.7484624249616976`*^9, 3.748462433960782*^9}, {3.748464519009124*^9, 
   3.748464602841921*^9}, {3.7484646594763603`*^9, 3.7484647235851192`*^9}, {
   3.7484651319395604`*^9, 3.748465285007676*^9}, {3.748465332914579*^9, 
   3.7484653570542636`*^9}, {3.7484654126483*^9, 3.7484654281495523`*^9}, {
   3.7484656597883687`*^9, 3.748465672109168*^9}, 3.74846570905568*^9, {
   3.7484657459288025`*^9, 3.748465746413306*^9}, {3.748466293273855*^9, 
   3.7484662945927315`*^9}, {3.7484669273567023`*^9, 3.748467004133011*^9}, {
   3.748467084778323*^9, 3.748467110800824*^9}, {3.748467165681593*^9, 
   3.7484671829150114`*^9}, {3.748467697398145*^9, 3.7484677028749037`*^9}, {
   3.7484890667468767`*^9, 3.7484890693939133`*^9}, {3.7484891736348314`*^9, 
   3.748489270305092*^9}, {3.748489322709747*^9, 3.748489348740595*^9}, {
   3.74849042012947*^9, 3.748490458089593*^9}, 3.7484905146615286`*^9, 
   3.7484905539817696`*^9, {3.7484925320890265`*^9, 3.748492536254943*^9}, {
   3.748533949016711*^9, 3.748533949701699*^9}, {3.7486278894526978`*^9, 
   3.7486279607303905`*^9}, {3.7486280246787653`*^9, 3.748628118296462*^9}}],

Cell["Hessian determinant with respect to p and B", "Item",
 CellChangeTimes->{{3.74846118122571*^9, 3.748461193507311*^9}, {
  3.7484612991876707`*^9, 3.7484613061325283`*^9}}],

Cell[BoxData[
 RowBox[{"FullSimplify", "[", 
  RowBox[{"Det", "[", 
   RowBox[{"D", "[", 
    RowBox[{"exprrExp", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"p", ",", "B"}], "}"}], ",", "2"}], "}"}]}], "]"}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.748458303897787*^9, 3.7484583044396086`*^9}, {
   3.748458781367812*^9, 3.7484588783520546`*^9}, {3.7484594659150352`*^9, 
   3.748459543897799*^9}, {3.7484596684920683`*^9, 3.7484598015543118`*^9}, {
   3.748460097616646*^9, 3.748460098252291*^9}, {3.7484603900425663`*^9, 
   3.7484604090390124`*^9}, 3.7484611962570753`*^9, {3.748462343226774*^9, 
   3.748462351718599*^9}, {3.748466267842725*^9, 3.748466268857727*^9}, 
   3.748467372932043*^9, 3.7484914016970763`*^9, {3.7484915661659546`*^9, 
   3.7484915807860436`*^9}}],

Cell["First partial derivative with respect to p", "Item",
 CellChangeTimes->{{3.748461197476244*^9, 3.7484612142417345`*^9}, 
   3.7484612967218604`*^9, {3.7484672299920225`*^9, 3.7484672314311705`*^9}, {
   3.748467714508232*^9, 3.7484677155513687`*^9}, {3.7484895853001966`*^9, 
   3.7484895862726045`*^9}}],

Cell[BoxData[
 RowBox[{"fswrtp", "=", 
  RowBox[{"FullSimplify", "[", 
   RowBox[{"D", "[", 
    RowBox[{"exprrExp", ",", 
     RowBox[{"{", 
      RowBox[{"p", ",", "1"}], "}"}]}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.748460567945*^9, 3.74846057089289*^9}, {
   3.7484616441175194`*^9, 3.7484616492427025`*^9}, 3.7484618036269293`*^9, 
   3.748462277007778*^9, {3.748462315262704*^9, 3.74846232884724*^9}, 
   3.7484662659445953`*^9, 3.748466309430065*^9}],

Cell["Second partial derivative with respect to p", "Item",
 CellChangeTimes->{
  3.7484673530495405`*^9, {3.748467469467948*^9, 3.748467520171215*^9}, {
   3.748487900779678*^9, 3.7484879050111413`*^9}}],

Cell[BoxData[
 RowBox[{"fswrtp2", "=", 
  RowBox[{"FullSimplify", "[", 
   RowBox[{"D", "[", 
    RowBox[{"exprrExp", ",", 
     RowBox[{"{", 
      RowBox[{"p", ",", "2"}], "}"}]}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.74846750832726*^9, 3.7484675861655726`*^9}, {
   3.748491664043647*^9, 3.748491677298514*^9}, 3.748627983967852*^9}],

Cell["Expression for B when p* is plugged in", "Item",
 CellChangeTimes->{{3.7484875597051573`*^9, 3.748487577411023*^9}}],

Cell[BoxData[
 RowBox[{"FullSimplify", "[", 
  RowBox[{"exprrExp", "/.", 
   RowBox[{"roots", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.748487580765148*^9, 3.748487626685481*^9}, 
   3.7484882615461974`*^9}],

Cell["First partial derivative with respect to B", "Item",
 CellChangeTimes->{{3.7484612764722443`*^9, 3.7484612787715063`*^9}}],

Cell[BoxData[
 RowBox[{"fswrtB", "=", 
  RowBox[{"FullSimplify", "[", 
   RowBox[{"D", "[", 
    RowBox[{"exprrExp", ",", 
     RowBox[{"{", 
      RowBox[{"B", ",", "1"}], "}"}]}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.748460567945*^9, 3.74846057089289*^9}, 
   3.748460863758241*^9, {3.748461735848321*^9, 3.7484618072468357`*^9}, {
   3.748461912155424*^9, 3.748461914424492*^9}, {3.7484623648522444`*^9, 
   3.7484623894290895`*^9}, {3.7484648200691586`*^9, 
   3.7484648203660483`*^9}, {3.7484648520742707`*^9, 
   3.7484648579298353`*^9}, {3.748464900580803*^9, 3.7484649224611864`*^9}, {
   3.7484649602359705`*^9, 3.7484649667887783`*^9}, 3.748466261905259*^9, 
   3.748466315976184*^9, {3.7484693080112095`*^9, 3.748469312492054*^9}, {
   3.7484898206805754`*^9, 3.7484898284182544`*^9}}],

Cell["Second partial derivative with respect to B", "Item",
 CellChangeTimes->{{3.7484672976167965`*^9, 3.7484673023016195`*^9}}],

Cell[BoxData[
 RowBox[{"fswrtB2", "=", 
  RowBox[{"FullSimplify", "[", 
   RowBox[{"D", "[", 
    RowBox[{"exprrExp", ",", 
     RowBox[{"{", 
      RowBox[{"B", ",", "2"}], "}"}]}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7484673050400686`*^9, 3.748467313930431*^9}, {
  3.748469365509667*^9, 3.748469385569721*^9}, {3.748490057120792*^9, 
  3.748490058792531*^9}}],

Cell["Plots", "Item",
 CellChangeTimes->{{3.7486282470694265`*^9, 3.748628247961655*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Btot", "=", "5"}], ";", 
  RowBox[{"pm", "=", "5"}], ";", " ", 
  RowBox[{"bm", "=", "2"}], ";", "  ", 
  RowBox[{"pr", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"k", "=", "10"}], ";", 
   RowBox[{"v", "=", "6"}], ";", 
   RowBox[{"l", "=", "3"}], ";", " ", 
   RowBox[{"d", "=", "2"}], ";", " ", 
   RowBox[{"b", "=", "5"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"N", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"1", "+", 
      RowBox[{"2", "*", "bm", "*", "k", "*", "pr"}]}], ")"}], "/", 
    RowBox[{"(", 
     RowBox[{"2", "*", "k"}], ")"}]}], "]"}], "   ", 
  RowBox[{"(*", 
   RowBox[{"transportation", "-", 
    RowBox[{"only", " ", "maximum"}]}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Plot3D", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"l", "^", "2"}], "*", "b", "*", 
      RowBox[{"(", 
       RowBox[{"p", "-", 
        RowBox[{"pr", "*", "bm"}]}], ")"}], "*", 
      RowBox[{"Exp", "[", 
       RowBox[{
        RowBox[{"-", "2"}], "*", "k", "*", "p"}], "]"}], "*", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Integrate", "[", 
         RowBox[{
          RowBox[{"t", "*", "v", "*", 
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{"-", "v"}], "*", "t"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"t", ",", "0", ",", 
            RowBox[{"B", "/", "bm"}]}], "}"}]}], "]"}], ")"}], "^", "2"}]}], 
     "+", 
     RowBox[{
      RowBox[{"pm", "/", "d"}], "*", 
      RowBox[{"(", 
       RowBox[{"Btot", "-", "B"}], ")"}], "*", 
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"l", "*", "b", "*", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "k"}], "*", "p"}], "]"}], "*", 
         RowBox[{"Integrate", "[", 
          RowBox[{
           RowBox[{"t", "*", "v", "*", 
            RowBox[{"Exp", "[", 
             RowBox[{
              RowBox[{"-", "v"}], "*", "t"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "0", ",", 
             RowBox[{"B", "/", "bm"}]}], "}"}]}], "]"}]}]}], ")"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"p", ",", "0", ",", "28"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"B", ",", "0", ",", "Btot"}], "}"}], ",", 
    RowBox[{"AxesLabel", "\[Rule]", "Automatic"}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.748489810401651*^9, 3.748489811275052*^9}, {
   3.7484901323258953`*^9, 3.7484901426056285`*^9}, {3.7484901838712516`*^9, 
   3.748490225570236*^9}, {3.748490304537305*^9, 3.7484903765190787`*^9}, 
   3.7484904078990726`*^9, {3.74849058320576*^9, 3.748490703140877*^9}, {
   3.748490776063697*^9, 3.7484908553203535`*^9}, {3.7484909363602076`*^9, 
   3.748490971144658*^9}, {3.748491030303995*^9, 3.748491057824891*^9}, {
   3.7484910902399063`*^9, 3.748491138532886*^9}, {3.748491235288373*^9, 
   3.748491332149645*^9}, {3.748491373907851*^9, 3.748491374173466*^9}, 
   3.7484917577372255`*^9, {3.748491841001299*^9, 3.7484919015067406`*^9}, {
   3.7484919427217445`*^9, 3.7484920148238077`*^9}, {3.7484920630441523`*^9, 
   3.7484920640451417`*^9}, {3.7484921424079466`*^9, 
   3.7484921967933683`*^9}, {3.7484922327520742`*^9, 
   3.7484922651401963`*^9}, {3.748492332689944*^9, 3.748492359232089*^9}, 
   3.7484923931321716`*^9, {3.748492425382315*^9, 3.7484924610711365`*^9}, {
   3.748492657315091*^9, 3.748492673353193*^9}, {3.748492717762185*^9, 
   3.7484927535481195`*^9}, {3.7484928144609823`*^9, 
   3.7484928354936447`*^9}, {3.7484928659206667`*^9, 
   3.7484929794604173`*^9}, {3.7484930143798604`*^9, 3.7484930273181667`*^9}, 
   3.748493068245861*^9, 3.7484931134402275`*^9, {3.7484931445490294`*^9, 
   3.748493176400193*^9}, 3.7484932515175076`*^9, 3.7484935256769114`*^9, {
   3.7484935610055695`*^9, 3.748493561271207*^9}, {3.748493643627322*^9, 
   3.748493661335258*^9}, {3.748493708977756*^9, 3.748493765975735*^9}, {
   3.7485360947106752`*^9, 3.748536095364894*^9}, {3.748536148009817*^9, 
   3.7485361504449463`*^9}, {3.7485368098087783`*^9, 
   3.7485368375407524`*^9}, {3.748537372510062*^9, 3.748537380081999*^9}, {
   3.748537429992961*^9, 3.7485374309031415`*^9}, {3.7485374765241337`*^9, 
   3.7485374770397654`*^9}, {3.7485375396218224`*^9, 
   3.7485375707808647`*^9}, {3.7485495336483574`*^9, 3.7485495491312*^9}, {
   3.74862448604866*^9, 3.7486245053044662`*^9}, {3.7486245596684713`*^9, 
   3.748624562339698*^9}, 3.748624611290455*^9, 3.7486246605274887`*^9, {
   3.748624814017432*^9, 3.748624818466075*^9}, {3.7486249095886393`*^9, 
   3.748624909713644*^9}, {3.7486249445630283`*^9, 3.748624947101666*^9}, 
   3.748625041581074*^9, {3.748627772648326*^9, 3.748627777186263*^9}, {
   3.7486282611777887`*^9, 3.748628295170954*^9}}]
},
WindowSize->{759, 713},
WindowMargins->{{281, Automatic}, {Automatic, 22}},
FrontEndVersion->"11.0 for Microsoft Windows (64-bit) (September 21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 761, 19, 88, "Input"],
Cell[1322, 41, 298, 5, 29, "Item"],
Cell[1623, 48, 234, 6, 30, "Input"],
Cell[1860, 56, 3576, 88, 126, "Input"],
Cell[5439, 146, 177, 2, 29, "Item"],
Cell[5619, 150, 819, 17, 30, "Input"],
Cell[6441, 169, 310, 4, 29, "Item"],
Cell[6754, 175, 468, 10, 30, "Input"],
Cell[7225, 187, 204, 3, 29, "Item"],
Cell[7432, 192, 347, 8, 30, "Input"],
Cell[7782, 202, 122, 1, 29, "Item"],
Cell[7907, 205, 248, 6, 30, "Input"],
Cell[8158, 213, 128, 1, 29, "Item"],
Cell[8289, 216, 807, 15, 30, "Input"],
Cell[9099, 233, 129, 1, 29, "Item"],
Cell[9231, 236, 374, 9, 30, "Input"],
Cell[9608, 247, 89, 1, 29, "Item"],
Cell[9700, 250, 5070, 111, 316, "Input"]
}
]
*)

